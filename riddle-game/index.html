<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>수수께끼 게임</title>
  <style>
    :root {
      --bg1: #fff8e8;
      --bg2: #e9f7ff;
      --card: #ffffff;
      --line: #f2d6ad;
      --main: #ff8a3d;
      --text: #2d2d2d;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 18px;
      font-family: "Malgun Gothic", sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 8% 12%, #fffef6, var(--bg1) 36%, var(--bg2) 100%);
    }
    .app {
      width: min(860px, 100%);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #fff;
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 12px 28px rgba(59, 90, 112, 0.18);
    }
    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    h1 {
      margin: 0;
      color: var(--main);
      font-size: clamp(24px, 4.2vw, 34px);
    }
    .stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-weight: 700;
      font-size: 14px;
    }
    .pill {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      background: #fff;
    }
    .board {
      position: relative;
      border: 1px solid var(--line);
      border-radius: 16px;
      background: var(--card);
      padding: 16px;
      display: grid;
      gap: 12px;
    }
    .feedback-box {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 6px;
      align-items: center;
      z-index: 2;
    }
    .feedback-btn {
      border: 1px solid #d8e3ed;
      border-radius: 999px;
      background: #fff;
      color: #39424a;
      font-size: 13px;
      font-weight: 700;
      padding: 4px 8px;
      line-height: 1;
      cursor: pointer;
    }
    .feedback-btn.active {
      border-color: #4f8fff;
      color: #1f5ed9;
      background: #eef4ff;
    }
    .feedback-msg {
      font-size: 11px;
      color: #6a7783;
      min-width: 36px;
      text-align: right;
    }
    #question {
      margin: 0;
      text-align: center;
      font-size: clamp(24px, 5vw, 38px);
      font-weight: 800;
      min-height: 56px;
      word-break: keep-all;
    }
    #hint, #answer {
      margin: 0;
      text-align: center;
      min-height: 34px;
      font-size: clamp(17px, 3vw, 22px);
      font-weight: 700;
      color: #4b5d69;
    }
    #answer {
      color: #167d49;
      min-height: 40px;
      font-size: clamp(22px, 3.8vw, 28px);
    }
    .actions {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    button {
      border: 0;
      border-radius: 12px;
      padding: 12px 10px;
      font-size: 16px;
      font-weight: 800;
      color: #fff;
      cursor: pointer;
    }
    #hintBtn { background: linear-gradient(135deg, #40b5c7, #5ed4b6); }
    #answerBtn { background: linear-gradient(135deg, #ff8a3d, #ffb56f); }
    #nextBtn {
      background: linear-gradient(135deg, #6a81ff, #90a4ff);
      grid-column: 1 / -1;
    }

    .effects-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 999;
    }

    .firework {
      --dx: 0px;
      --dy: -100px;
      --size: 7px;
      --dur: 850ms;
      --hue: 0deg;
      position: absolute;
      width: var(--size);
      height: var(--size);
      left: 0;
      top: 0;
      border-radius: 50%;
      background: hsl(var(--hue), 95%, 58%);
      box-shadow: 0 0 10px hsl(var(--hue), 95%, 58%);
      animation: firework-burst var(--dur) ease-out forwards;
    }
    .sources {
      margin: 6px 0 0;
      font-size: 12px;
      color: #65717a;
      text-align: center;
    }
    @media (max-width: 640px) {
      .actions { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }

    @keyframes firework-burst {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(var(--dx), var(--dy)) scale(0.2);
        opacity: 0;
      }
    }
  </style>
</head>
<body>
  <div id="effectsLayer" class="effects-layer"></div>
  <main class="app">
    <div class="top">
      <h1>수수께끼 게임</h1>
      <div class="stats">
        <span class="pill">문제 <span id="progress">1</span>/<span id="total">149</span></span>
        <span class="pill">정답 보기 <span id="seen">0</span>개</span>
      </div>
    </div>

    <section class="board">
      <div class="feedback-box" aria-label="문제 피드백">
        <button id="likeBtn" class="feedback-btn" type="button" aria-label="좋아요">👍</button>
        <button id="dislikeBtn" class="feedback-btn" type="button" aria-label="별로예요">👎</button>
        <span id="feedbackMsg" class="feedback-msg"></span>
      </div>
      <p id="question"></p>
      <p id="hint">힌트 보기 버튼을 눌러보세요.</p>
      <p id="answer"></p>
      <div class="actions">
        <button id="hintBtn" type="button">힌트 보기</button>
        <button id="answerBtn" type="button">정답 보기</button>
        <button id="nextBtn" type="button">다음 문제</button>
      </div>
    </section>
  </main>

  <script>
    const riddles = [
      { q: "검어도 검고, 희어도 검고, 붉어도 검은 것은", a: "그림자", h: "?? ??? ? ?????." },
      { q: "말 중에서 탈 수 없는 말은", a: "거짓말", h: "?? ??? ? ?????." },
      { q: "반쯤 앉고 반쯤 서서 추는 춤은", a: "엉거주춤", h: "?? ??? ? ?????." },
      { q: "먹을 수 없는 닭은", a: "까닭", h: "?? ??? ? ?????." },
      { q: "놀부가 가장 좋아하는 술은", a: "심술", h: "?? ??? ? ?????." },
      { q: "초록 주머니에는 은돈이, 빨간 주머니에는 금돈이 있는 것은", a: "고추", h: "?? ??? ? ?????." },
      { q: "누가 웃으면 따라 웃고, 누가 울면 따라 우는 것은", a: "거울", h: "?? ??? ? ?????." },
      { q: "먹기는 먹어도 배부르지 않는 것은", a: "공기", h: "?? ??? ? ?????." },
      { q: "뼈 속에 물, 물속에 황금이 있는 것은", a: "달걀", h: "?? ??? ? ?????." },
      { q: "위로 먹고, 옆으로 똥 누는 것은", a: "맷돌", h: "?? ??? ? ?????." },
      { q: "한 날개로 사람을 하루에도 몇 번씩 삼켰다 토했다 하는 것은", a: "문", h: "?? ??? ? ?????." },
      { q: "칼로 배어도 잘라지지 않는 것은", a: "물", h: "?? ??? ? ?????." },
      { q: "귓구멍 하나만 가지고 숨바꼭질하면서 사는 것은", a: "바늘", h: "?? ??? ? ?????." },
      { q: "발도 없이 어디든지 마음대로 다니는 것은", a: "바람", h: "?? ??? ? ?????." },
      { q: "가시 안에 매끈, 매끈 안에 털털, 털털 안에 맛있는 것은", a: "밤", h: "?? ??? ? ?????." },
      { q: "깊은 골짜기에서 나팔불며 나오는 것은", a: "방귀", h: "?? ??? ? ?????." },
      { q: "마른 옷은 벗고, 축축한 옷만 입는 것은", a: "빨랫줄", h: "?? ??? ? ?????." },
      { q: "한 칸 방에 머리를 가지런히 하고 빽빽하게 누워 있는 것은", a: "성냥", h: "?? ??? ? ?????." },
      { q: "초록 집 속에 하얀 집, 하얀 집 속에 빨간 집, 빨간 집 속에 까만 아이들이 모여 사는 것은", a: "수박", h: "?? ??? ? ?????." },
      { q: "태어나서 죽을 때까지 산수 공부만 하는 것은", a: "시계", h: "?? ??? ? ?????." },
      { q: "짐을 지면 가고 짐을 지지 않으면 안 가는 것은", a: "신발", h: "?? ??? ? ?????." },
      { q: "이 산 저 산 나무를 다 먹고도 매가 고파서 입 벌리고 있는 것은", a: "아궁이", h: "?? ??? ? ?????." },
      { q: "덤불 밑에 도마, 도마 밑에 송충이, 송충이 밑에 깜빡이, 깜빡이 밑에 훌쩍이, 훌쩍이 밑에 쩝쩝이, 쩝쩝이 밑에 낭떠러지는", a: "얼굴", h: "?? ??? ? ?????." },
      { q: "머리 풀고 하늘로 올라가는 것은", a: "연기", h: "?? ??? ? ?????." },
      { q: "펴면 집이 되고, 접으면 지팡이가 되는 것은", a: "우산", h: "?? ??? ? ?????." },
      { q: "매일 같이 밥을 만지고 반찬을 만져도 발을 동동 구르며 얻어먹지 못하는 것은", a: "젓가락", h: "?? ??? ? ?????." },
      { q: "빨간 모자 쓰고 흰옷 입고 눈물 뚝뚝 흘리는 것은", a: "초", h: "?? ??? ? ?????." },
      { q: "굴뚝 밑으로 흰 강아지가 나왔다 들어갔다 하는 것은", a: "콧물", h: "?? ??? ? ?????." },
      { q: "구리 중에서 동이 아닌 구리는", a: "딱따구리", h: "?? ??? ? ?????." },
      { q: "들 수는 있지만 오르지 못하는 산은", a: "우산", h: "?? ??? ? ?????." },
      { q: "미남을 다섯 글자로 하면", a: "미련한남자", h: "?? ??? ? ?????." },
      { q: "사람들이 싫어하는 금은", a: "세금", h: "?? ??? ? ?????." },
      { q: "물 중에서 마시지 않고 씹어 먹는 물은", a: "나물", h: "?? ??? ? ?????." },
      { q: "병균 중에서 우두머리 병균은", a: "대장균", h: "?? ??? ? ?????." },
      { q: "정삼각형의 동생 이름은", a: "정삼각", h: "?? ??? ? ?????." },
      { q: "먹지 않고 내버리는 50가지 밥은", a: "쉰밥", h: "?? ??? ? ?????." },
      { q: "땅속에 묻힌 마그마의 반대말은", a: "뚫으마", h: "?? ??? ? ?????." },
      { q: "변호사와 검사 중 누가 더 큰 모자를 쓸까", a: "머리가 큰 사람", h: "?? ??? ? ?????." },
      { q: "손님이 깎아달라는 대로 다 깎아주는 사람은", a: "이발사", h: "?? ??? ? ?????." },
      { q: "병든 사람들이 가장 받고 싶어 하는 복은", a: "회복", h: "?? ??? ? ?????." },
      { q: "대통령 선거의 반대는", a: "대통령 앉은거", h: "?? ??? ? ?????." },
      { q: "속상한 일이 없으면 만나지 않는 사람은", a: "내과 의사", h: "?? ??? ? ?????." },
      { q: "사람들이 받기 좋아하는 벌은", a: "재벌", h: "?? ??? ? ?????." },
      { q: "신발이 화가 나면", a: "신발 끈", h: "?? ??? ? ?????." },
      { q: "아무도 읽을 수 없는 책 두 권은", a: "주책, 속수무책", h: "?? ??? ? ?????." },
      { q: "창피한 것도 체면도 없는 사람의 나이는", a: "넉살", h: "?? ??? ? ?????." },
      { q: "아홉 명의 자식을 세 자로 줄이면", a: "아이구", h: "?? ??? ? ?????." },
      { q: "먹을 수 없는 죽은", a: "뒤죽박죽", h: "?? ??? ? ?????." },
      { q: "정말 어렵게 지은 절은", a: "우여곡절", h: "?? ??? ? ?????." },
      { q: "아무것도 넣을 수 없는데 걸어 다니는 주머니는", a: "아주머니", h: "?? ??? ? ?????." },
      { q: "기러기를 거꾸로 하면 기러기, 쓰레기통을 거꾸로 하면", a: "쏟아진다.", h: "?? ??? ? ?????." },
      { q: "문 두드린 여자는", a: "똑똑한 여자", h: "?? ??? ? ?????." },
      { q: "눈이 튀어나오는 용은", a: "띠용", h: "?? ??? ? ?????." },
      { q: "차가운 도시 여자 차도녀의 반대는", a: "인도녀", h: "?? ??? ? ?????." },
      { q: "독수리 5마리는 독수리 오형제, 쥐 4마리는", a: "쥐포", h: "?? ??? ? ?????." },
      { q: "아부쟁이가 믿는 신은", a: "굽신굽신", h: "?? ??? ? ?????." },
      { q: "자가용의 반대는", a: "커용", h: "?? ??? ? ?????." },
      { q: "사람 욕심을 한 글자로 표현하면", a: "더", h: "?? ??? ? ?????." },
      { q: "창문을 여니 신이 날고 있었다는 이야기는", a: "신 나는 이야기", h: "?? ??? ? ?????." },
      { q: "할아버지와 손자가 길을 가는데 산에 불이 났다. 손자가 한 말은", a: "산타 할아버지", h: "?? ??? ? ?????." },
      { q: "차는 없고 사람만 걸어 다니는 나라는", a: "인도", h: "?? ??? ? ?????." },
      { q: "오스트리아의 돈은", a: "호주머니", h: "?? ??? ? ?????." },
      { q: "무가 넥타이를 매면", a: "무에타이", h: "?? ??? ? ?????." },
      { q: "오이가 무를 쳤다면", a: "오이무침", h: "?? ??? ? ?????." },
      { q: "가장 인기가 좋은 파는", a: "파스타", h: "?? ??? ? ?????." },
      { q: "먹을수록 덜덜 떨리는 음식은", a: "추어탕", h: "?? ??? ? ?????." },
      { q: "무를 재료로 해서 만들 수 있는 반찬의 가짓 수는", a: "무진장", h: "?? ??? ? ?????." },
      { q: "가장 오래된 망고는", a: "할망고", h: "?? ??? ? ?????." },
      { q: "빵이 시골로 간 까닭은", a: "소보러", h: "?? ??? ? ?????." },
      { q: "매사에 가장 긍정적인 동물은", a: "돼지", h: "?? ??? ? ?????." },
      { q: "세상에서 가장 장사를 잘하는 고양이는", a: "슈퍼마켓", h: "?? ??? ? ?????." },
      { q: "4마리의 고양이가 몬스터로 변하면", a: "포켓 몬스터", h: "?? ??? ? ?????." },
      { q: "입이 아닌 귀로 먹는 것은", a: "욕", h: "?? ??? ? ?????." },
      { q: "아무리 태워도 연기가 나지 않는 것은", a: "일광욕", h: "?? ??? ? ?????." },
      { q: "이것저것 자꾸 보려고 하는 곡식은", a: "보리", h: "?? ??? ? ?????." },
      { q: "음매음매 우는 나무는", a: "소나무", h: "?? ??? ? ?????." },
      { q: "방에서 살 수 없는 사람은", a: "눈사람", h: "?? ??? ? ?????." },
      { q: "밤이나 낮이나 가리지 않고 재우려고 하는 것은", a: "자라", h: "?? ??? ? ?????." },
      { q: "덩치만 크지, 짖지도 못하고 물지도 못하는 개는", a: "산고개", h: "?? ??? ? ?????." },
      { q: "길이가 긴 음식 재료는", a: "김", h: "?? ??? ? ?????." },
      { q: "김보다 더 긴 음식 재료는", a: "참기름(참길음", h: "?? ??? ? ?????." },
      { q: "낮에는 계란말이, 밤에는 프라이인 것은", a: "이불", h: "?? ??? ? ?????." },
      { q: "머리 감을 때 가장 먼저 감는 것은", a: "눈", h: "?? ??? ? ?????." },
      { q: "축구 선수들은 어떻게 웃을까", a: "킥킥킥", h: "?? ??? ? ?????." },
      { q: "반짝이는 빛이 가득한데, 내 맘대로 몸이 잘 움직이지 않는 곳은", a: "우주", h: "?? ??? ? ?????." },
      { q: "밤에만 나타나 평생 살을 찌우고 빼는 것을 반복하는 것은", a: "달", h: "?? ??? ? ?????." },
      { q: "높은 하늘에 있는 불덩이는", a: "태양", h: "?? ??? ? ?????." },
      { q: "자리는 자리인데, 밤하늘에 깔려 있는 자리는", a: "별자리", h: "?? ??? ? ?????." },
      { q: "큰 소리로 방귀 뀌며 하늘로 날아가는 것은", a: "로켓", h: "?? ??? ? ?????." },
      { q: "어두울수록 잘 보이는 것은", a: "별", h: "?? ??? ? ?????." },
      { q: "하얀 세상에서 가장 많이 찧는 방아는", a: "엉덩방아", h: "?? ??? ? ?????." },
      { q: "눈과 얼음이 녹아 자라지고 나면, 무엇이 찾아올까", a: "봄", h: "?? ??? ? ?????." },
      { q: "늘 둥근데, 사람들이 '길다', '짧다' 하는 것은", a: "태양", h: "?? ??? ? ?????." },
      { q: "태양과 달, 화성, 수성, 목성, 금성, 토성이 만나면 무엇이 될까", a: "일주일", h: "?? ??? ? ?????." },
      { q: "달에 사는 물고기는", a: "문어", h: "?? ??? ? ?????." },
      { q: "우주에서 마시는 반짝이는 물은", a: "은하수", h: "?? ??? ? ?????." },
      { q: "꽃 중에서 나이를 가장 많이 먹은 꽃은", a: "백합", h: "?? ??? ? ?????." },
      { q: "앞으로 나가면 지고 뒤로 물러나면 이기는 것은", a: "줄다리기", h: "?? ??? ? ?????." },
      { q: "들어가는 구멍은 하나인데, 나오는 구멍은 둘인 것은", a: "바지", h: "?? ??? ? ?????." },
      { q: "가만히 있었는데도 뺨을 맞는 것은", a: "정답 : 성냥", h: "?? ??? ? ?????." },
      { q: "병아리가 먹는 약은", a: "정답 : 삐약", h: "?? ??? ? ?????." },
      { q: "걸을때 앞뒤로 흔들면서 걷는 것은", a: "정답 : 팔", h: "?? ??? ? ?????." },
      { q: "금은 금인데 비싸지 않은 금은 무엇일까", a: "정답 : 소금", h: "?? ??? ? ?????." },
      { q: "기둥은 하나지만 방이 2개나 있는 것은", a: "정답 :코", h: "?? ??? ? ?????." },
      { q: "깨는 깬데 먹지 못하는 깨는", a: "정답 : 주근깨", h: "?? ??? ? ?????." },
      { q: "꽃만 먹고 사는 것은 무엇일까", a: "정답 : 꽃병", h: "?? ??? ? ?????." },
      { q: "공부시간에 공부하지 않아도 혼나지 않는 사람은", a: "정답 : 선생님", h: "?? ??? ? ?????." },
      { q: "학교에 가지만 공부는 하지 않고 오는 것은", a: "정답 : 가방", h: "?? ??? ? ?????." },
      { q: "밤낮없이 남의 말을 전하는 것은", a: "정답 : 핸드폰", h: "?? ??? ? ?????." },
      { q: "나무로 짓는 밥은", a: "정답 : 톱밥", h: "?? ??? ? ?????." },
      { q: "날개는 있지만 날수는 없고 윙윙 소리를 내지만 모기가 아닌 것은", a: "정답 : 선풍기", h: "?? ??? ? ?????." },
      { q: "늙을 수록 젊어 보이는 한 가지는", a: "정답 : 사진", h: "?? ??? ? ?????." },
      { q: "나무를 주면 잘 살지만, 물을 주면 금방 죽어버리는 것은", a: "정답 : 불", h: "?? ??? ? ?????." },
      { q: "나리는 나리인데 허리를 굽혀 인사하지 않는 나리는", a: "정답 : 개나리", h: "?? ??? ? ?????." },
      { q: "더운날말 골라서 일을 하는 것은", a: "정답 : 에어컨", h: "?? ??? ? ?????." },
      { q: "양은 양인데 호랑이한테 마음껏 덤비는 양은", a: "정답 : 정신나간 양", h: "?? ??? ? ?????." },
      { q: "맞아오면 엄마가 좋아하는 것은", a: "정답 : 백점", h: "?? ??? ? ?????." },
      { q: "삼각모자를 쓰고 다리가 열개인 것은", a: "정답 : 오징어", h: "?? ??? ? ?????." },
      { q: "여름에 일어나는 전쟁은", a: "정답 : 더워", h: "?? ??? ? ?????." },
      { q: "다리는 튼튼하지만 갈비뼈만 앙상한 것은", a: "정답 : 사다리", h: "?? ??? ? ?????." },
      { q: "뒤로 가면 이기고 앞으로 가면 지는 것은", a: "정답 : 줄다리기", h: "?? ??? ? ?????." },
      { q: "달리면 바로 서있고 멈추면 쓰러지는 것은", a: "정답 : 자전거", h: "?? ??? ? ?????." },
      { q: "닦으면 닦을수록 더러워지는 것은", a: "정답 : 걸레", h: "?? ??? ? ?????." },
      { q: "들어갈때는 딱딱하지만 나올 때는 말랑말랑 해지는 것은", a: "정답 : 껌", h: "?? ??? ? ?????." },
      { q: "더운 날에도 옷을 여러겹 껴입고 있는 것은", a: "정답 : 옥수수", h: "?? ??? ? ?????." },
      { q: "다리로 올라가서 엉덩이로 내려오는 것은", a: "정답 : 미끄럼틀", h: "?? ??? ? ?????." },
      { q: "두들기면 조용히 일어나는 것은", a: "정답 : 먼지0", h: "?? ??? ? ?????." },
      { q: "날지 못하는 제비는", a: "정답 : 족제비", h: "?? ??? ? ?????." },
      { q: "말을 말인데 달리지 못하는 말은", a: "정답 : 거짓말", h: "?? ??? ? ?????." },
      { q: "많이 먹을수록 하늘로 올라가는 것은", a: "정답 : 풍선", h: "?? ??? ? ?????." },
      { q: "물은 물인데 사람들이 무서워서 벌벌 떠는 물은", a: "정답 : 괴물", h: "?? ??? ? ?????." },
      { q: "문은 문인데 닫을 수 없는 문은", a: "정답 : 소문", h: "?? ??? ? ?????." },
      { q: "물구나무하면 오히려 손해를 보면 숫자는", a: "정답 : 숫자 9", h: "?? ??? ? ?????." },
      { q: "물은 물인데 사람들이 가장 좋아하는 물은", a: "정답 : 선물", h: "?? ??? ? ?????." },
      { q: "다리는 있지만 발이 없는 것은", a: "정답 : 바지", h: "?? ??? ? ?????." },
      { q: "비는 비인데 뜯어먹을 수 있는 비는", a: "정답 : 갈비", h: "?? ??? ? ?????." },
      { q: "불이 붙지 않는 초는", a: "정답 : 식초", h: "?? ??? ? ?????." },
      { q: "비가 오면 피고 비가 그치면 지는 것은", a: "정답 : 우산", h: "?? ??? ? ?????." },
      { q: "밤에는 절대 찾을 수 없는 것은", a: "정답 : 해", h: "?? ??? ? ?????." },
      { q: "산에 숨어 살면서 남의 흉내만 내는 것은", a: "정답 : 메아리", h: "?? ??? ? ?????." },
      { q: "치아 중에 가장 마지막에 나는 치아는", a: "정답 : 틀니", h: "?? ??? ? ?????." },
      { q: "틀릴 때마다 찾아와 머리를 문지르는 것은", a: "정답 : 지우개", h: "?? ??? ? ?????." },
      { q: "세상에서 가장 아름다운 개는", a: "정답 : 무지개", h: "?? ??? ? ?????." },
      { q: "온몸이 하얀 사람은", a: "정답 : 눈사람", h: "?? ??? ? ?????." },
      { q: "실없는 사람에게는 필요 없는 것은", a: "정답 : 바늘", h: "?? ??? ? ?????." },
      { q: "물고기 중에 가장 똑똑한 물고기는", a: "물고기 중에 가장 학벌이 좋은 물고기는", h: "?? ??? ? ?????." },
      { q: "권투를 가장 잘하는 나라는", a: "싸움을 가장 좋아하는 나라는", h: "?? ??? ? ?????." },
      { q: "묵은 묵인데 먹지 못하는 묵은", a: "묵 중에 가장 조용한 묵은", h: "?? ??? ? ?????." },
      { q: "문은 문인데 닫지 못하는 문은", a: "문인데 잘 전달 되는 문은", h: "?? ??? ? ?????." },
    ];

    function sanitizeAnswer(answer) {
      return String(answer)
        .replace(/^\s*\(?\s*정답\s*[:：]\s*/u, "")
        .replace(/\)\s*$/u, "")
        .trim();
    }

    function normalizeHintAnswer(answer) {
      return sanitizeAnswer(answer).replace(/[\s,./!?:;'"()\[\]{}<>~`·ㆍ\-_=+*^$#@%&|\\]/gu, "");
    }

    const normalizedRiddles = riddles.map((item) => ({
      q: String(item.q || "").trim(),
      a: sanitizeAnswer(item.a || ""),
      h: "초성으로 맞혀보세요."
    }));

    const questionEl = document.getElementById("question");
    const hintEl = document.getElementById("hint");
    const answerEl = document.getElementById("answer");
    const progressEl = document.getElementById("progress");
    const totalEl = document.getElementById("total");
    const seenEl = document.getElementById("seen");
    const hintBtn = document.getElementById("hintBtn");
    const answerBtn = document.getElementById("answerBtn");
    const nextBtn = document.getElementById("nextBtn");
    const effectsLayerEl = document.getElementById("effectsLayer");
    const likeBtn = document.getElementById("likeBtn");
    const dislikeBtn = document.getElementById("dislikeBtn");
    const feedbackMsgEl = document.getElementById("feedbackMsg");

    const FEEDBACK_API_URL = window.RIDDLE_FEEDBACK_API_URL || "";

    let order = [];
    let index = 0;
    let hintStep = 0;
    let answerSeen = 0;
    let answerOpened = false;
    let autoNextTimeoutId = null;
    let autoNextIntervalId = null;
    const voteState = {};
    let feedbackMsgTimer = null;

    function shuffle(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function getChoseong(text) {
      const choseong = ["ㄱ", "ㄲ", "ㄴ", "ㄷ", "ㄸ", "ㄹ", "ㅁ", "ㅂ", "ㅃ", "ㅅ", "ㅆ", "ㅇ", "ㅈ", "ㅉ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"];
      return Array.from(text).map((char) => {
        const code = char.charCodeAt(0);
        if (code < 0xac00 || code > 0xd7a3) return char;
        const idx = Math.floor((code - 0xac00) / 588);
        return choseong[idx];
      }).join(" ");
    }

    function maskByLength(text) {
      return Array.from(text).map(() => "○").join(" ");
    }

    function currentRiddle() {
      return normalizedRiddles[order[index]];
    }

    function getRiddleId(item) {
      const raw = `${item.q}|${item.a}`;
      let hash = 2166136261;
      for (let i = 0; i < raw.length; i += 1) {
        hash ^= raw.charCodeAt(i);
        hash = Math.imul(hash, 16777619);
      }
      return `r${(hash >>> 0).toString(16)}`;
    }

    function setFeedbackMessage(text) {
      clearTimeout(feedbackMsgTimer);
      feedbackMsgEl.textContent = text;
      if (!text) return;
      feedbackMsgTimer = setTimeout(() => {
        feedbackMsgEl.textContent = "";
      }, 1200);
    }

    function refreshFeedbackButtons() {
      const item = currentRiddle();
      const riddleId = getRiddleId(item);
      const vote = voteState[riddleId] || "";
      likeBtn.classList.toggle("active", vote === "like");
      dislikeBtn.classList.toggle("active", vote === "dislike");
      feedbackMsgEl.textContent = "";
    }

    async function sendFeedback(vote) {
      const item = currentRiddle();
      const riddleId = getRiddleId(item);
      voteState[riddleId] = vote;
      refreshFeedbackButtons();

      if (!FEEDBACK_API_URL) {
        setFeedbackMessage("저장됨");
        return;
      }

      try {
        const response = await fetch(FEEDBACK_API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            game: "riddle-game",
            riddleId,
            question: item.q,
            answer: item.a,
            vote,
            createdAt: new Date().toISOString()
          })
        });
        if (!response.ok) throw new Error("failed");
        setFeedbackMessage("전송됨");
      } catch {
        setFeedbackMessage("실패");
      }
    }

    function updateStats() {
      progressEl.textContent = String(index + 1);
      seenEl.textContent = String(answerSeen);
    }

    function launchAnswerFireworks() {
      const bursts = 2;
      const piecesPerBurst = 16;
      for (let b = 0; b < bursts; b += 1) {
        const originX = window.innerWidth * (0.28 + Math.random() * 0.44);
        const originY = window.innerHeight * (0.25 + Math.random() * 0.35);
        for (let i = 0; i < piecesPerBurst; i += 1) {
          const dot = document.createElement("span");
          dot.className = "firework";
          const angle = (Math.PI * 2 * i) / piecesPerBurst + (Math.random() * 0.4 - 0.2);
          const distance = 48 + Math.random() * 120;
          const dx = Math.cos(angle) * distance;
          const dy = Math.sin(angle) * distance;
          const hue = Math.floor(Math.random() * 360);
          const size = 5 + Math.random() * 5;
          const duration = 700 + Math.random() * 260;
          dot.style.left = `${originX}px`;
          dot.style.top = `${originY}px`;
          dot.style.setProperty("--dx", `${dx.toFixed(2)}px`);
          dot.style.setProperty("--dy", `${dy.toFixed(2)}px`);
          dot.style.setProperty("--hue", `${hue}deg`);
          dot.style.setProperty("--size", `${size.toFixed(2)}px`);
          dot.style.setProperty("--dur", `${duration.toFixed(0)}ms`);
          effectsLayerEl.appendChild(dot);
          setTimeout(() => dot.remove(), duration + 80);
        }
      }
    }

    function clearAutoNextCountdown() {
      clearTimeout(autoNextTimeoutId);
      clearInterval(autoNextIntervalId);
      autoNextTimeoutId = null;
      autoNextIntervalId = null;
      nextBtn.textContent = "다음 문제";
    }

    function startAutoNextCountdown() {
      clearAutoNextCountdown();
      let remain = 4;
      nextBtn.textContent = `다음 문제 (${remain})`;

      autoNextIntervalId = setInterval(() => {
        remain -= 1;
        if (remain <= 0) {
          clearInterval(autoNextIntervalId);
          autoNextIntervalId = null;
          return;
        }
        nextBtn.textContent = `다음 문제 (${remain})`;
      }, 1000);

      autoNextTimeoutId = setTimeout(() => {
        autoNextTimeoutId = null;
        nextQuestion();
      }, 4000);
    }

    function renderQuestion() {
      const item = currentRiddle();
      const hintAnswer = normalizeHintAnswer(item.a);
      clearAutoNextCountdown();
      questionEl.textContent = item.q;
      hintEl.textContent = `글자수 힌트: ${maskByLength(hintAnswer)}`;
      answerEl.textContent = "";
      hintBtn.hidden = false;
      answerBtn.hidden = false;
      nextBtn.hidden = true;
      hintStep = 0;
      answerOpened = false;
      refreshFeedbackButtons();
      updateStats();
    }

    function showHint() {
      const item = currentRiddle();
      const chosungHint = getChoseong(normalizeHintAnswer(item.a));
      hintEl.textContent = `초성 힌트: ${chosungHint}`;
    }

    function showAnswer() {
      if (!answerOpened) {
        answerSeen += 1;
        answerOpened = true;
        launchAnswerFireworks();
        hintBtn.hidden = true;
        answerBtn.hidden = true;
        nextBtn.hidden = false;
        startAutoNextCountdown();
      }
      answerEl.textContent = `정답: ${currentRiddle().a}`;
      updateStats();
    }

    function nextQuestion() {
      clearAutoNextCountdown();
      index += 1;
      if (index >= normalizedRiddles.length) {
        order = shuffle([...Array(normalizedRiddles.length).keys()]);
        index = 0;
      }
      renderQuestion();
    }

    hintBtn.addEventListener("click", showHint);
    answerBtn.addEventListener("click", showAnswer);
    nextBtn.addEventListener("click", nextQuestion);
    likeBtn.addEventListener("click", () => sendFeedback("like"));
    dislikeBtn.addEventListener("click", () => sendFeedback("dislike"));

    function init() {
      clearAutoNextCountdown();
      order = shuffle([...Array(normalizedRiddles.length).keys()]);
      index = 0;
      hintStep = 0;
      answerSeen = 0;
      answerOpened = false;
      totalEl.textContent = String(normalizedRiddles.length);
      renderQuestion();
    }

    init();
  </script>
</body>
</html>
