<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>수수께끼 게임</title>
  <style>
    :root {
      --bg1: #fff8e8;
      --bg2: #e9f7ff;
      --card: #ffffff;
      --line: #f2d6ad;
      --main: #ff8a3d;
      --text: #2d2d2d;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: grid;
      place-items: center;
      padding: 18px;
      font-family: "Malgun Gothic", sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 8% 12%, #fffef6, var(--bg1) 36%, var(--bg2) 100%);
    }
    .app {
      width: min(860px, 100%);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #fff;
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 12px 28px rgba(59, 90, 112, 0.18);
    }
    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 12px;
    }
    h1 {
      margin: 0;
      color: var(--main);
      font-size: clamp(24px, 4.2vw, 34px);
    }
    .stats {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      font-weight: 700;
      font-size: 14px;
    }
    .pill {
      border: 1px solid var(--line);
      border-radius: 999px;
      padding: 6px 10px;
      background: #fff;
    }
    .board {
      border: 1px solid var(--line);
      border-radius: 16px;
      background: var(--card);
      padding: 16px;
      display: grid;
      gap: 12px;
    }
    #question {
      margin: 0;
      text-align: center;
      font-size: clamp(24px, 5vw, 38px);
      font-weight: 800;
      min-height: 56px;
      word-break: keep-all;
    }
    #hint, #answer {
      margin: 0;
      text-align: center;
      min-height: 34px;
      font-size: clamp(17px, 3vw, 22px);
      font-weight: 700;
      color: #4b5d69;
    }
    #answer {
      color: #167d49;
      min-height: 40px;
    }
    .actions {
      display: grid;
      gap: 10px;
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    button {
      border: 0;
      border-radius: 12px;
      padding: 12px 10px;
      font-size: 16px;
      font-weight: 800;
      color: #fff;
      cursor: pointer;
    }
    #hintBtn { background: linear-gradient(135deg, #40b5c7, #5ed4b6); }
    #answerBtn { background: linear-gradient(135deg, #ff8a3d, #ffb56f); }
    #nextBtn {
      background: linear-gradient(135deg, #6a81ff, #90a4ff);
      grid-column: 1 / -1;
    }
    .sources {
      margin: 6px 0 0;
      font-size: 12px;
      color: #65717a;
      text-align: center;
    }
    @media (max-width: 640px) {
      .actions { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    }
  </style>
</head>
<body>
  <main class="app">
    <div class="top">
      <h1>수수께끼 게임</h1>
      <div class="stats">
        <span class="pill">문제 <span id="progress">1</span>/<span id="total">300</span></span>
        <span class="pill">정답 보기 <span id="seen">0</span>개</span>
      </div>
    </div>

    <section class="board">
      <p id="question"></p>
      <p id="hint">힌트 보기 버튼을 눌러보세요.</p>
      <p id="answer"></p>
      <div class="actions">
        <button id="hintBtn" type="button">힌트 보기</button>
        <button id="answerBtn" type="button">정답 보기</button>
        <button id="nextBtn" type="button">다음 문제</button>
      </div>
      <p class="sources">인터넷 넌센스 문제 스타일을 반영해 확장한 300문제입니다.</p>
    </section>
  </main>

  <script>
    const seedRiddles = [
      { q: "모자가 화나면 뭐가 될까?", a: "모자람", h: "모자 + 감정 단어를 이어요." },
      { q: "구름이 깜짝 놀라면?", a: "구르릉", h: "천둥소리를 떠올려요." },
      { q: "양말이 숨바꼭질하면?", a: "짝꿍찾기", h: "양말은 항상 둘이 다녀요." },
      { q: "연필이 쉬는 시간에 하는 일은?", a: "심심풀이", h: "연필 안쪽을 뭐라고 부르죠?" },
      { q: "토끼가 제일 잘하는 운동은?", a: "깡총뛰기", h: "토끼가 이동하는 소리." },
      { q: "시계가 졸리면 내는 소리는?", a: "똑깜", h: "똑딱의 앞부분을 떠올려요." },
      { q: "도넛이 친구를 만나면?", a: "반가워링", h: "도넛은 모양이 동그란 링." },
      { q: "바다가 웃을 때 나는 소리는?", a: "철썩하하", h: "파도소리 + 웃음." },
      { q: "쿠키가 춤추면?", a: "쿠키댄스", h: "영어 단어 dance를 붙여요." },
      { q: "가방이 화가 나면?", a: "가방방", h: "방이 반복돼요." },
      { q: "눈사람이 여름 계획을 세우면?", a: "그늘예약", h: "뜨거운 햇빛을 피해야 해요." },
      { q: "우산이 노래하면?", a: "우산송", h: "song을 붙여요." },
      { q: "지우개가 뛰면?", a: "지우개개", h: "마지막 소리가 한 번 더." },
      { q: "비행기가 간식을 먹으면?", a: "에어냠냠", h: "air + 냠냠." },
      { q: "별이 잠오면?", a: "별쿨쿨", h: "잠잘 때 나는 소리." },
      { q: "컵이 놀라면?", a: "컵짝", h: "깜짝의 뒷부분 느낌." },
      { q: "고양이가 수업 들으면?", a: "냥학생", h: "고양이 울음소리를 붙여요." },
      { q: "햄버거가 화나면?", a: "불버거", h: "화나면 불이 붙어요." },
      { q: "기차가 웃으면?", a: "칙칙하하", h: "기차 소리를 먼저 생각해요." },
      { q: "수박이 빠르게 달리면?", a: "수박슝", h: "빠른 소리 '슝'." }
    ];

    const things = [
      "사과", "딸기", "수박", "포도", "귤", "멜론", "복숭아", "레몬", "자두", "체리",
      "햄버거", "피자", "김밥", "떡볶이", "치킨", "라면", "만두", "핫도그", "도넛", "쿠키",
      "강아지", "고양이", "토끼", "곰", "사자", "호랑이", "코끼리", "악어", "펭귄", "원숭이",
      "연필", "지우개", "책", "가방", "시계", "우산", "신발", "양말", "모자", "컵",
      "구름", "비", "눈", "해", "달", "별", "바람", "파도", "무지개", "번개",
      "로봇", "자동차", "비행기", "기차", "버스", "자전거", "스케이트", "열기구", "잠수함", "우주선",
      "풍선", "비누", "솜사탕", "초콜릿", "케이크", "젤리", "아이스크림", "사탕", "팝콘", "주스",
      "공룡", "고래", "문어", "판다", "여우", "늑대", "부엉이", "다람쥐", "달팽이", "나비"
    ];

    const moodWords = ["하하", "냠냠", "쿨쿨", "둥실", "반짝", "뿅뿅", "두근", "폴짝"];
    const placeWords = ["학교", "바다", "우주", "놀이터", "도서관", "공원"];
    const suffixWords = ["댄스", "송", "슝", "짠", "팡", "스타", "요정"];

    const templates = [
      { q: (t) => `${t}가 웃으면?`, a: (t) => `${t}${moodWords[0]}`, h: "웃을 때 나는 소리를 붙여요." },
      { q: (t) => `${t}가 배고프면?`, a: (t) => `${t}${moodWords[1]}`, h: "먹는 소리를 떠올려요." },
      { q: (t) => `${t}가 졸리면?`, a: (t) => `${t}${moodWords[2]}`, h: "잠잘 때 나는 소리." },
      { q: (t) => `${t}가 하늘로 떠오르면?`, a: (t) => `${t}${moodWords[3]}`, h: "둥둥 뜨는 느낌 단어." },
      { q: (t) => `${t}가 빛나면?`, a: (t) => `${t}${moodWords[4]}`, h: "빛나는 소리 표현." },
      { q: (t) => `${t}가 마술을 배우면?`, a: (t) => `${t}${moodWords[5]}`, h: "마술 소리 단어." },
      { q: (t) => `${t}가 심장이 두근거리면?`, a: (t) => `${t}${moodWords[6]}`, h: "긴장될 때 나는 느낌." },
      { q: (t) => `${t}가 점프하면?`, a: (t) => `${t}${moodWords[7]}`, h: "점프 소리 표현." },
      { q: (t) => `${t}가 노래하면?`, a: (t) => `${t}${suffixWords[1]}`, h: "song을 한국식으로." },
      { q: (t) => `${t}가 춤추면?`, a: (t) => `${t}${suffixWords[0]}`, h: "dance 단어를 떠올려요." },
      { q: (t) => `${t}가 엄청 빠르면?`, a: (t) => `${t}${suffixWords[2]}`, h: "빠르게 지나가는 소리." },
      { q: (t) => `${t}가 파티에 가면?`, a: (t) => `${t}${suffixWords[3]}`, h: "파티에서 외치는 말." },
      { q: (t) => `${t}가 깜짝 놀라면?`, a: (t) => `${t}${suffixWords[4]}`, h: "팡 터지는 느낌." },
      { q: (t) => `${t}가 TV에 나오면?`, a: (t) => `${t}${suffixWords[5]}`, h: "스타가 돼요." },
      { q: (t) => `${t}가 숲에 살면?`, a: (t) => `${t}${suffixWords[6]}`, h: "동화 속 존재." },
      { q: (t) => `${t}가 학교에 가면?`, a: (t) => `${t}학생`, h: "학생이 돼요." },
      { q: (t) => `${t}가 요리하면?`, a: (t) => `${t}요리사`, h: "직업 이름을 붙여요." },
      { q: (t) => `${t}가 그림 그리면?`, a: (t) => `${t}화가`, h: "그림 그리는 사람." },
      { q: (t) => `${t}가 여행 가면?`, a: (t) => `${t}여행단`, h: "여행하는 팀 이름." },
      { q: (t) => `${t}가 ${placeWords[2]}에 가면?`, a: (t) => `${t}우주대장`, h: "우주의 리더 느낌." }
    ];

    function buildOriginalRiddles(targetCount) {
      const out = [];
      const used = new Set();

      function pushUnique(item) {
        const key = `${item.q}__${item.a}`;
        if (used.has(key)) return;
        used.add(key);
        out.push(item);
      }

      seedRiddles.forEach(pushUnique);

      for (let i = 0; i < things.length; i += 1) {
        const thing = things[i];
        for (let j = 0; j < templates.length; j += 1) {
          const temp = templates[(i + j) % templates.length];
          pushUnique({
            q: temp.q(thing),
            a: temp.a(thing),
            h: temp.h
          });
          if (out.length >= targetCount) return out;
        }
      }

      let idx = 1;
      while (out.length < targetCount) {
        const t = things[idx % things.length];
        const p = placeWords[idx % placeWords.length];
        pushUnique({
          q: `보너스 ${idx}: ${t}가 ${p}에서 소풍 가면?`,
          a: `${t}${p}소풍단`,
          h: "문제에 나온 두 단어를 이어보세요."
        });
        idx += 1;
      }
      return out.slice(0, targetCount);
    }

    const riddles = buildOriginalRiddles(300);

    const questionEl = document.getElementById("question");
    const hintEl = document.getElementById("hint");
    const answerEl = document.getElementById("answer");
    const progressEl = document.getElementById("progress");
    const totalEl = document.getElementById("total");
    const seenEl = document.getElementById("seen");
    const hintBtn = document.getElementById("hintBtn");
    const answerBtn = document.getElementById("answerBtn");
    const nextBtn = document.getElementById("nextBtn");

    let order = [];
    let index = 0;
    let hintStep = 0;
    let answerSeen = 0;
    let answerOpened = false;
    let autoNextTimeoutId = null;
    let autoNextIntervalId = null;

    function shuffle(arr) {
      const copy = [...arr];
      for (let i = copy.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [copy[i], copy[j]] = [copy[j], copy[i]];
      }
      return copy;
    }

    function getChoseong(text) {
      const choseong = ["ㄱ", "ㄲ", "ㄴ", "ㄷ", "ㄸ", "ㄹ", "ㅁ", "ㅂ", "ㅃ", "ㅅ", "ㅆ", "ㅇ", "ㅈ", "ㅉ", "ㅊ", "ㅋ", "ㅌ", "ㅍ", "ㅎ"];
      return Array.from(text).map((char) => {
        const code = char.charCodeAt(0);
        if (code < 0xac00 || code > 0xd7a3) return char;
        const idx = Math.floor((code - 0xac00) / 588);
        return choseong[idx];
      }).join("");
    }

    function maskByLength(text) {
      return Array.from(text).map(() => "○").join(" ");
    }

    function currentRiddle() {
      return riddles[order[index]];
    }

    function updateStats() {
      progressEl.textContent = String(index + 1);
      seenEl.textContent = String(answerSeen);
    }

    function clearAutoNextCountdown() {
      clearTimeout(autoNextTimeoutId);
      clearInterval(autoNextIntervalId);
      autoNextTimeoutId = null;
      autoNextIntervalId = null;
      nextBtn.textContent = "다음 문제";
    }

    function startAutoNextCountdown() {
      clearAutoNextCountdown();
      let remain = 3;
      nextBtn.textContent = `다음 문제 (${remain})`;

      autoNextIntervalId = setInterval(() => {
        remain -= 1;
        if (remain <= 0) {
          clearInterval(autoNextIntervalId);
          autoNextIntervalId = null;
          return;
        }
        nextBtn.textContent = `다음 문제 (${remain})`;
      }, 1000);

      autoNextTimeoutId = setTimeout(() => {
        autoNextTimeoutId = null;
        nextQuestion();
      }, 3000);
    }

    function renderQuestion() {
      const item = currentRiddle();
      clearAutoNextCountdown();
      questionEl.textContent = item.q;
      hintEl.textContent = `글자수 힌트: ${maskByLength(item.a)}`;
      answerEl.textContent = "";
      nextBtn.hidden = true;
      hintStep = 0;
      answerOpened = false;
      updateStats();
    }

    function showHint() {
      const item = currentRiddle();
      const chosungHint = getChoseong(item.a);
      hintStep += 1;

      if (hintStep === 1) {
        hintEl.textContent = `추가 힌트: ${item.h}`;
        return;
      }
      hintEl.textContent = `초성 힌트: ${chosungHint}`;
    }

    function showAnswer() {
      if (!answerOpened) {
        answerSeen += 1;
        answerOpened = true;
        nextBtn.hidden = false;
        startAutoNextCountdown();
      }
      answerEl.textContent = `정답: ${currentRiddle().a}`;
      updateStats();
    }

    function nextQuestion() {
      clearAutoNextCountdown();
      index += 1;
      if (index >= riddles.length) {
        order = shuffle([...Array(riddles.length).keys()]);
        index = 0;
      }
      renderQuestion();
    }

    hintBtn.addEventListener("click", showHint);
    answerBtn.addEventListener("click", showAnswer);
    nextBtn.addEventListener("click", nextQuestion);

    function init() {
      clearAutoNextCountdown();
      order = shuffle([...Array(riddles.length).keys()]);
      index = 0;
      hintStep = 0;
      answerSeen = 0;
      answerOpened = false;
      totalEl.textContent = String(riddles.length);
      renderQuestion();
    }

    init();
  </script>
</body>
</html>
